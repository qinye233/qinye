<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>麦克风可视化示例</title>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        margin: 0;
        background-color: #212121;
      }

      #circle {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background-color: #fff;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.8);
        animation: pulse 1s ease-in-out alternate infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
          filter: brightness(1);
        }
        50% {
          transform: scale(1.2);
          filter: brightness(1.5);
        }
        100% {
          transform: scale(1);
          filter: brightness(1);
        }
      }
    </style>
  </head>
  <body>
    <div id="circle"></div>
    <script>
      const circle = document.getElementById('circle');

      // 获取麦克风输入流
      navigator.mediaDevices.getUserMedia({audio: true})
        .then(function(stream) {
          var audioContext = new AudioContext();
          var source = audioContext.createMediaStreamSource(stream);
          var analyser = audioContext.createAnalyser();
          source.connect(analyser);

          // 设置分析参数
          analyser.fftSize = 2048;
          var bufferLength = analyser.frequencyBinCount;
          var dataArray = new Uint8Array(bufferLength);

          var circleSize = 50;
          var hue = 0;

          function renderFrame() {
            requestAnimationFrame(renderFrame);

            // 获取音频数据并计算得分
            analyser.getByteFrequencyData(dataArray);
            var score = 0;
            for (var i = 0; i < dataArray.length; i++) {
              score += dataArray[i] / bufferLength;
            }

            // 更新圆球大小和颜色
            circleSize = Math.max(Math.min(score * 10, 500), 10);
            hue = (hue + score * 0.2) % 360;

            circle.style.width = circleSize + 'px';
            circle.style.height = circleSize + 'px';
            circle.style.boxShadow = '0 0 ' + (score * 0.5 + 20) + 'px rgba(255, 255, 255, 0.8)';
            circle.style.backgroundColor = 'hsl(' + hue + ', 70%, 50%)';
          }
          renderFrame();
        })
        .catch(function(err) {
          console.log('获取麦克风失败：', err);
        });
    </script>
  </body>
</html>
